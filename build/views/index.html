<!doctype html>
<html lang="en">

<head>
  <title>Rubbernecker</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
  <link rel="stylesheet" href="./app.css">
  <meta http-equiv="refresh" content="300">
  <script type="text/javascript">
		setInterval(() => {
			console.info('About to update with new Rubbernecker data')
			fetch('')
			.then(response => {
				if (response.status != 200) {
					console.error(
						'Request to Rubbernecker server did not response with 200',
						response
					)
				}
				return response.text()
			})
			.then(responseContents => {
				let elem = document.createElement('html')
				elem.innerHTML = responseContents
				let body = elem.querySelector('body')
				document.querySelector('body').innerHTML = body.innerHTML
				console.info('Updated document body with new Rubbernecker data')
			})
		}, 15 * 1000)
  </script>
</head>

<body class="container-fluid">
  {{$next := .Cards.Filter "next"}}
  {{$doing := .Cards.Filter "doing"}}
  {{$reviewing := .Cards.Filter "reviewing"}}
  {{$approving := .Cards.Filter "approving"}}
  {{$rejected := .Cards.Filter "rejected"}}
  {{$done := .Cards.Filter "done"}}

  <header class="text-center">
    <ul>
      <li><strong>In hours</strong>: <em class="in-hours">{{(index .SupportRota "in-hours").Member}}</em></li>
      <li><strong>Out of hours</strong>: <em class="out-of-hours">{{(index .SupportRota "out-of-hours").Member}}</em></li>
      <li><strong>Escalations</strong>: <em class="escalations">{{(index .SupportRota "escalations").Member}}</em></li>
    </ul>

    <div class="btn-group btn-group-toggle" data-toggle="buttons">
      <label class="btn btn-outline-dark btn-sm" onclick="app.filterNonTech(false)">
        <input type="radio" name="tech" autocomplete="off"> Tech
      </label>
      <label class="btn btn-outline-dark btn-sm" onclick="app.filterNonTech(true)">
        <input type="radio" name="non-tech" autocomplete="off"> Non-Tech
      </label>
      <label class="btn btn-outline-dark btn-sm active" onclick="app.resetFilter()">
        <input type="radio" name="all" autocomplete="off" checked> Show all
      </label>
    </div>
  </header>

  <main class="row">
    <section id="next" class="col" data-cards="{{(len $next)}}">
      <h2>Next</h2>

      {{range $next}}
        {{template "thin-card" .}}
      {{end}}
    </section>

    <section id="doing" class="col" data-cards="{{(len $doing)}}">
      <h2>Doing <small><span>{{len $doing}}</span></small></h2>

      {{range $doing}}
        {{template "card" .}}
      {{end}}
    </section>

    <section id="reviewing" class="col" data-cards="{{(len $reviewing)}}" data-limit="{{.Config.ReviewalLimit}}">
      <h2>
        Reviewing
        <small data-limit="{{.Config.ReviewalLimit}}" class="{{if gt (len $reviewing) .Config.ReviewalLimit}}text-danger{{end}}">
          <span>{{len $reviewing}}</span>/{{.Config.ReviewalLimit}}
        </small>
      </h2>

      {{range $reviewing}}
        {{template "card" .}}
      {{end}}
    </section>

    <div class="col">
      <section id="rejected" data-cards="{{(len $rejected)}}">
        <h2>Rejected <small><span>{{len $rejected}}</span></small></h2>

        {{range $rejected}}
          {{template "card" .}}
        {{end}}
      </section>

      <section id="approving" data-cards="{{(len $approving)}}" data-limit="{{.Config.ApprovalLimit}}">
        <h2>
          Approving
          <small class="{{if gt (len $approving) .Config.ApprovalLimit}}text-danger{{end}}">
            <span>{{len $approving}}</span>/{{.Config.ApprovalLimit}}
          </small>
        </h2>

        {{range $approving}}
          {{template "card" .}}
        {{end}}
      </section>
    </div>

    <section id="done" class="col" data-cards="{{(len $done)}}">
      <h2>Done <small><span>{{len $done}}</span></small></h2>

      {{range $done}}
        {{template "thin-card" .}}
      {{end}}
    </section>
  </main>

  <footer style="display: none;">
    <ul>
      {{range .FreeTeamMembers}}
        <li>{{.Name}}</li>
      {{end}}
    </ul>

    <span>{{len .FreeTeamMembers}}</span>
  </footer>
</body>

</html>
