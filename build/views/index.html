<!doctype html>
<html lang="en">

<head>
  <title>Rubbernecker</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
  <link rel="stylesheet" href="./app.css">
</head>

<body class="container-fluid">
  {{$next := .Cards.Filter "next"}}
  {{$doing := .Cards.Filter "doing"}}
  {{$reviewing := .Cards.Filter "reviewing"}}
  {{$approving := .Cards.Filter "approving"}}
  {{$rejected := .Cards.Filter "rejected"}}
  {{$done := .Cards.Filter "done"}}

  <header class="text-center">
    <ul>
      <li><strong>In hours</strong>: <em class="in-hours">{{(index .SupportRota "in-hours").Member}}</em></li>
      <li><strong>Out of hours</strong>: <em class="out-of-hours">{{(index .SupportRota "out-of-hours").Member}}</em></li>
      <li><strong>Escalations</strong>: <em class="escalations">{{(index .SupportRota "escalations").Member}}</em></li>
    </ul>
  </header>

  <main class="row">
    <section id="next" class="column collapsed left" style="display:none;">
      <h2>Next</h2>

      {{range $next}}
        {{template "card" .}}
      {{end}}
    </section>

    <section id="doing" class="col" data-cards="{{(len $doing)}}">
      <h2>Doing <small><span>{{len $doing}}</span></small></h2>

      {{range $doing}}
        {{template "card" .}}
      {{end}}
    </section>

    <section id="reviewing" class="col" data-cards="{{(len $reviewing)}}" data-limit="{{.Config.ReviewalLimit}}">
      <h2>
        Reviewing
        <small data-limit="{{.Config.ReviewalLimit}}" class="{{if gt (len $reviewing) .Config.ReviewalLimit}}text-danger{{end}}">
          <span>{{len $reviewing}}</span>/{{.Config.ReviewalLimit}}
        </small>
      </h2>

      {{range $reviewing}}
        {{template "card" .}}
      {{end}}
    </section>

    <div class="col">
      <section id="rejected" data-cards="{{(len $rejected)}}">
        <h2>Rejected <small><span>{{len $rejected}}</span></small></h2>

        {{range $rejected}}
          {{template "card" .}}
        {{end}}
      </section>

      <section id="approving" data-cards="{{(len $approving)}}" data-limit="{{.Config.ApprovalLimit}}">
        <h2>
          Approving
          <small class="{{if gt (len $approving) .Config.ApprovalLimit}}text-danger{{end}}">
            <span>{{len $approving}}</span>/{{.Config.ApprovalLimit}}
          </small>
        </h2>

        {{range $approving}}
          {{template "card" .}}
        {{end}}
      </section>
    </div>

    <section id="done" class="col" data-cards="{{(len $done)}}">
      <h2>Done <small>{{len $done}}</small></h2>

      {{range $done}}
        {{template "thin-card" .}}
      {{end}}
    </section>
  </main>

  <footer style="display: none;">
    <ul>
      {{range .FreeTeamMembers}}
        <li>{{.Name}}</li>
      {{end}}
    </ul>

    <span>{{len .FreeTeamMembers}}</span>
  </footer>

  <script id="card-template" type="text/template">
    {{template "card" (index .Cards 0)}}
  </script>
  <script id="thin-card-template" type="text/template">
    {{template "thin-card" (index .Cards 0)}}
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
  <script src="./app.js"></script>

  <script>
    const app = new Application();
    app.run();
  </script>
</body>

</html>
