<!doctype html>
<html lang="en">

<head>
  <title>Rubbernecker</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
  <link rel="stylesheet" href="./app.css">
</head>

<body class="container-fluid">
  {{$next := .Cards.Filter "next"}}
  {{$doing := .Cards.Filter "doing"}}
  {{$reviewing := .Cards.Filter "reviewing"}}
  {{$approving := .Cards.Filter "approving"}}
  {{$rejected := .Cards.Filter "rejected"}}
  {{$done := .Cards.Filter "done"}}

  <header class="text-center">
    <ul>
      <li><strong>In hours</strong>: <em class="in-hours">{{(index .SupportRota "in-hours").Member}}</em></li>
      <li><strong>Out of hours</strong>: <em class="out-of-hours">{{(index .SupportRota "out-of-hours").Member}}</em></li>
      <li><strong>Escalations</strong>: <em class="escalations">{{(index .SupportRota "escalations").Member}}</em></li>
    </ul>

    <div class="btn-group btn-group-toggle" data-toggle="buttons">
      <label class="btn btn-outline-dark btn-sm" onclick="app.filterTeam('a')">
        <input type="radio" name="a" autocomplete="off"> Team A
      </label>
      <label class="btn btn-outline-dark btn-sm" onclick="app.filterTeam('b')">
        <input type="radio" name="b" autocomplete="off"> Team B
      </label>
      <label class="btn btn-outline-dark btn-sm" onclick="app.filterTeam('c')">
        <input type="radio" name="c" autocomplete="off"> Team C
      </label>
      <label class="btn btn-outline-dark btn-sm active" onclick="app.resetFilter()">
        <input type="radio" name="all" autocomplete="off" checked> Show all
      </label>
    </div>
  </header>

  <main class="row">
    <section id="next" class="col" data-cards="{{(len $next)}}">
      <h2>Next</h2>

      {{range $next}}
        {{template "thin-card" .}}
      {{end}}
    </section>

    <section id="doing" class="col" data-cards="{{(len $doing)}}">
      <h2>Doing <small><span>{{len $doing}}</span></small></h2>

      {{range $doing}}
        {{template "card" .}}
      {{end}}
    </section>

    <section id="reviewing" class="col" data-cards="{{(len $reviewing)}}" data-limit="{{.Config.ReviewalLimit}}">
      <h2>
        Reviewing
        <small data-limit="{{.Config.ReviewalLimit}}" class="{{if gt (len $reviewing) .Config.ReviewalLimit}}text-danger{{end}}">
          <span>{{len $reviewing}}</span>/{{.Config.ReviewalLimit}}
        </small>
      </h2>

      {{range $reviewing}}
        {{template "card" .}}
      {{end}}
    </section>

    <div class="col">
      <section id="rejected" data-cards="{{(len $rejected)}}">
        <h2>Rejected <small><span>{{len $rejected}}</span></small></h2>

        {{range $rejected}}
          {{template "card" .}}
        {{end}}
      </section>

      <section id="approving" data-cards="{{(len $approving)}}" data-limit="{{.Config.ApprovalLimit}}">
        <h2>
          Approving
          <small class="{{if gt (len $approving) .Config.ApprovalLimit}}text-danger{{end}}">
            <span>{{len $approving}}</span>/{{.Config.ApprovalLimit}}
          </small>
        </h2>

        {{range $approving}}
          {{template "card" .}}
        {{end}}
      </section>
    </div>

    <section id="done" class="col" data-cards="{{(len $done)}}">
      <h2>Done <small>{{len $done}}</small></h2>

      {{range $done}}
        {{template "thin-card" .}}
      {{end}}
    </section>
  </main>

  <footer style="display: none;">
    <ul>
      {{range .FreeTeamMembers}}
        <li>{{.Name}}</li>
      {{end}}
    </ul>

    <span>{{len .FreeTeamMembers}}</span>
  </footer>

  <script id="card-template" type="text/template">
    {{if len .Cards}}
      {{template "card" (index .Cards 0)}}
    {{end}}
  </script>
  <script id="thin-card-template" type="text/template">
    {{if len .Cards}}
      {{template "thin-card" (index .Cards 0)}}
    {{end}}
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" crossorigin="anonymous"></script>
  <script src="./app.js"></script>

  <script>
    const app = new Application();
    app.run();
  </script>
</body>

</html>
